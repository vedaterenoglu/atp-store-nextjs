query GetMostPurchasedProductsClient(
  $company_id: String!
  $customer_id: String!
  $bd: String!
  $ed: String!
) {
  goods_transactions(
    where: {
      goods_transactions_dispatch_haeaders_rel: {
        company_id: { _eq: $company_id }
        customer_id: { _eq: $customer_id }
        dispatch_date: { _gte: $bd, _lte: $ed }
      }
    }
    distinct_on: stock_id
  ) {
    goods_transactions_stock_rel {
      stock_id
      stock_name
    }
    goods_transaction_goods_transaction_rel_aggregate(
      where: {
        goods_transactions_dispatch_haeaders_rel: {
          company_id: { _eq: $company_id }
          customer_id: { _eq: $customer_id }
          dispatch_date: { _gte: $bd, _lte: $ed }
        }
      }
    ) {
      aggregate {
        sum {
          amount_credit
        }
      }
    }
  }
  goods_transactions_aggregate(
    where: {
      goods_transactions_dispatch_haeaders_rel: {
        company_id: { _eq: $company_id }
        customer_id: { _eq: $customer_id }
        dispatch_date: { _gte: $bd, _lte: $ed }
      }
    }
  ) {
    aggregate {
      count(columns: stock_id, distinct: true)
    }
  }
}