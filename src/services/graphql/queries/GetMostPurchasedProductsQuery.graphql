query GetMostPurchasedProducts(
  $company_id: String!
  $customer_id: String!
  $bd: date!
  $ed: date!
) {
  goods_transactions(
    where: {
      goods_transactions_dispatch_haeaders_rel: {
        company_id: { _eq: $company_id }
        customer_id: { _eq: $customer_id }
        dispatch_date: { _gte: $bd, _lte: $ed }
      }
    }
    distinct_on: stock_id
  ) {
    stock_id
    goods_transactions_stock_rel {
      stock_id
      stock_name
      stock_price
      stock_unit
      stock_group
      stock_image_link
    }
    goods_transaction_goods_transaction_rel_aggregate(
      where: {
        goods_transactions_dispatch_haeaders_rel: {
          company_id: { _eq: $company_id }
          customer_id: { _eq: $customer_id }
          dispatch_date: { _gte: $bd, _lte: $ed }
        }
      }
    ) {
      aggregate {
        sum {
          amount_credit
        }
      }
    }
  }
  goods_transactions_aggregate(
    where: {
      goods_transactions_dispatch_haeaders_rel: {
        company_id: { _eq: $company_id }
        customer_id: { _eq: $customer_id }
        dispatch_date: { _gte: $bd, _lte: $ed }
      }
    }
  ) {
    aggregate {
      count(columns: stock_id, distinct: true)
    }
  }
}

# Variables:
# - bd (begin date): calculated as today - NEXT_PUBLIC_CONSUMPTION_PERIOD_IN_DAYS
# - ed (end date): today
#
# Example:
# {
#   "company_id": "alfe",
#   "customer_id": "SE0 1001 1086",
#   "bd": "2025-05-07",
#   "ed": "2025-08-06"
# }

# todo: response
# {
#   "data": {
#     "goods_transactions": [
#       {
#         "stock_id": "1001 1001 0026",
#         "goods_transactions_stock_rel": {
#           "stock_id": "1001 1001 0026",
#           "stock_name": "Pizzakartonger 26*26*3,5 100 st./förp.",
#           "stock_price": 23000,
#           "stock_unit": "förp.",
#           "stock_group": "1000 - Pizzakartonger",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 1
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "1001 1007 R033",
#         "goods_transactions_stock_rel": {
#           "stock_id": "1001 1007 R033",
#           "stock_name": "Pizzakrtong 33*33*3,5 Premium 100 st./förp.",
#           "stock_price": 23900,
#           "stock_unit": "förp.",
#           "stock_group": "1000 - Pizzakartonger",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 24
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "1001 1010 0050",
#         "goods_transactions_stock_rel": {
#           "stock_id": "1001 1010 0050",
#           "stock_name": "Pizzakartong 50*50*4 50 st./förp.",
#           "stock_price": 42500,
#           "stock_unit": "förp.",
#           "stock_group": "1000 - Pizzakartonger",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 5
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "1001 1011 2816",
#         "goods_transactions_stock_rel": {
#           "stock_id": "1001 1011 2816",
#           "stock_name": "Pizzakartong Calzone 28*16*8 100 st./förp. Röda",
#           "stock_price": 28000,
#           "stock_unit": "förp.",
#           "stock_group": "1000 - Pizzakartonger",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 3
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "1001 1014 V033",
#         "goods_transactions_stock_rel": {
#           "stock_id": "1001 1014 V033",
#           "stock_name": "Pizzakartong 33*33*3,5 Tillfälligt Besök 100 st./förp.",
#           "stock_price": 22900,
#           "stock_unit": "förp.",
#           "stock_group": "1000 - Pizzakartonger",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 2
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "1601 1002 0002",
#         "goods_transactions_stock_rel": {
#           "stock_id": "1601 1002 0002",
#           "stock_name": "XXL Rulle Nyfiber ",
#           "stock_price": 25800,
#           "stock_unit": "st.",
#           "stock_group": "1600 - Hygienpapper",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 2
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "1601 1002 P002",
#         "goods_transactions_stock_rel": {
#           "stock_id": "1601 1002 P002",
#           "stock_name": "XXL Rulle Nyfiber  Premium 1200 meter",
#           "stock_price": 39900,
#           "stock_unit": "st.",
#           "stock_group": "1600 - Hygienpapper",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 1
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "1601 1003 0003",
#         "goods_transactions_stock_rel": {
#           "stock_id": "1601 1003 0003",
#           "stock_name": "Minirulle 12 st./kolli",
#           "stock_price": 29900,
#           "stock_unit": "kolli",
#           "stock_group": "1600 - Hygienpapper",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 3
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "1601 1008 0007",
#         "goods_transactions_stock_rel": {
#           "stock_id": "1601 1008 0007",
#           "stock_name": "Toalettpapper Mini-Jumbo 12 st/förp.",
#           "stock_price": 23500,
#           "stock_unit": "förp.",
#           "stock_group": "1600 - Hygienpapper",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 2
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "2001 1001 0200",
#         "goods_transactions_stock_rel": {
#           "stock_id": "2001 1001 0200",
#           "stock_name": "Salladsbägare med Lock 200 ml 400 st/.kolli",
#           "stock_price": 24400,
#           "stock_unit": "kolli",
#           "stock_group": "2000 - Bägare",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 9
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "2001 1001 E200",
#         "goods_transactions_stock_rel": {
#           "stock_id": "2001 1001 E200",
#           "stock_name": "Salladsbägare med Lock ECO 200 ml 500 st/.kolli",
#           "stock_price": 24900,
#           "stock_unit": "förp.",
#           "stock_group": "2000 - Bägare",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 3
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "2001 1004 0100",
#         "goods_transactions_stock_rel": {
#           "stock_id": "2001 1004 0100",
#           "stock_name": "Såsbägare med Lock 100 ml 1000 st./kolli",
#           "stock_price": 49900,
#           "stock_unit": "kolli",
#           "stock_group": "2000 - Bägare",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 3
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "2501 1001 0002",
#         "goods_transactions_stock_rel": {
#           "stock_id": "2501 1001 0002",
#           "stock_name": "Salladsskål UFO 1000 ml 300 pack",
#           "stock_price": 99900,
#           "stock_unit": "förp.",
#           "stock_group": "2500 - Micro- & Sallad Förpackningar",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 1
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "3001 1001 XPP1",
#         "goods_transactions_stock_rel": {
#           "stock_id": "3001 1001 XPP1",
#           "stock_name": "Hämtbox Bruna 1-fack 100 st./förp. Premium",
#           "stock_price": 30000,
#           "stock_unit": "förp.",
#           "stock_group": "3000 - Avhämtningslådor PAP/BAGASSE",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 9
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "4001 1004 0004",
#         "goods_transactions_stock_rel": {
#           "stock_id": "4001 1004 0004",
#           "stock_name": "Servetter 40*40 Vit 2-Lag 1400 pack",
#           "stock_price": 42000,
#           "stock_unit": "kolli",
#           "stock_group": "4000 - Servetter & Ljus",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 3
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "5001 1002 0045",
#         "goods_transactions_stock_rel": {
#           "stock_id": "5001 1002 0045",
#           "stock_name": "Aluminiumfolie 45 cm ",
#           "stock_price": 19900,
#           "stock_unit": "st.",
#           "stock_group": "5000 - Folie & Film",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 8
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "5001 1006 0060",
#         "goods_transactions_stock_rel": {
#           "stock_id": "5001 1006 0060",
#           "stock_name": "Plastfolie 60 cm perforerad",
#           "stock_price": 24200,
#           "stock_unit": "st.",
#           "stock_group": "5000 - Folie & Film",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 1
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "6001 1001 0001",
#         "goods_transactions_stock_rel": {
#           "stock_id": "6001 1001 0001",
#           "stock_name": "Maskindiskmedel Diversy 12,8 kg",
#           "stock_price": 45000,
#           "stock_unit": "dunk",
#           "stock_group": "6000 - Rengöringskem. & Rengöringstillbehör",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 1
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "6001 1002 0002",
#         "goods_transactions_stock_rel": {
#           "stock_id": "6001 1002 0002",
#           "stock_name": "Handdiskmedel Orginal, 750 ml",
#           "stock_price": 3500,
#           "stock_unit": "st.",
#           "stock_group": "6000 - Rengöringskem. & Rengöringstillbehör",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 24
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "6001 1002 C002",
#         "goods_transactions_stock_rel": {
#           "stock_id": "6001 1002 C002",
#           "stock_name": "Handdiskmedel Citron, 750 ml",
#           "stock_price": 3500,
#           "stock_unit": "st.",
#           "stock_group": "6000 - Rengöringskem. & Rengöringstillbehör",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 8
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "6001 1006 1004",
#         "goods_transactions_stock_rel": {
#           "stock_id": "6001 1006 1004",
#           "stock_name": "Fylttande Handtvål 500 ml Orkide",
#           "stock_price": 1500,
#           "stock_unit": "st.",
#           "stock_group": "6000 - Rengöringskem. & Rengöringstillbehör",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 8
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "6001 1009 G007",
#         "goods_transactions_stock_rel": {
#           "stock_id": "6001 1009 G007",
#           "stock_name": "Dasty Gul Fetlösare",
#           "stock_price": 4900,
#           "stock_unit": "st.",
#           "stock_group": "6000 - Rengöringskem. & Rengöringstillbehör",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 12
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "6001 1017 0016",
#         "goods_transactions_stock_rel": {
#           "stock_id": "6001 1017 0016",
#           "stock_name": "Klorin 1,5 L",
#           "stock_price": 5000,
#           "stock_unit": "st.",
#           "stock_group": "6000 - Rengöringskem. & Rengöringstillbehör",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 24
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "7001 1006 0014",
#         "goods_transactions_stock_rel": {
#           "stock_id": "7001 1006 0014",
#           "stock_name": "Babsrulle Liten 100 st./kolli",
#           "stock_price": 35900,
#           "stock_unit": "kolli",
#           "stock_group": "7000 - Kassa & Babs",
#           "stock_image_link": "https://res.cloudinary.com/dnptbuf0s/image/upload/v1754299206/samples/atp-store-customer/alfe-fallback_nopd5j.jpg"
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 1
#             }
#           }
#         }
#       },
#       {
#         "stock_id": "8001 1001 0001",
#         "goods_transactions_stock_rel": {
#           "stock_id": "8001 1001 0001",
#           "stock_name": "Panasonic DGP-72",
#           "stock_price": 170000,
#           "stock_unit": "st.",
#           "stock_group": "8001- Hårmaskiner",
#           "stock_image_link": null
#         },
#         "goods_transaction_goods_transaction_rel_aggregate": {
#           "aggregate": {
#             "sum": {
#               "amount_credit": 5
#             }
#           }
#         }
#       }
#     ],
#     "goods_transactions_aggregate": {
#       "aggregate": {
#         "count": 25
#       }
#     }
#   }
# }
